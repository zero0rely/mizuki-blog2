import{o as ke,i as Ce,s as Ie}from"./lifecycle.BUKLqami.js";import{d as m,f as q,t as I,o as M,a as d,p as Ee,b as Le,g as t,m as H,e as u,h as E,s as x,r as v,c as U,v as Se}from"./utils.C6YlWNI1.js";import{s as L}from"./render.ekQlN2yD.js";import{i as h}from"./if.AUn_gUq8.js";import{e as se,i as oe}from"./each.BvHDNfc0.js";import{I as B}from"./Icon.CmzPY910.js";import{I as ae}from"./zh_TW.12WzXWON.js";import{i as ne}from"./translation.pwwn0x9t.js";import{n as ze}from"./navigation-utils.Cc6bKnia.js";import{panelManager as ie}from"./panel-manager.BYknToDe.js";/* empty css                        */import"./props.BdyWAK-0.js";import"./config.C6HpbU8S.js";var Pe=m('<div class="text-center py-8 text-black/50 dark:text-white/50"><!> <p>暂无文章</p></div>'),Ae=m('<div class="post-category svelte-cz3h3s"> </div>'),Oe=m('<button class="post-item svelte-cz3h3s"><div class="post-title svelte-cz3h3s"><!> </div> <!></button>'),qe=m('<div class="post-content svelte-cz3h3s"></div>'),Me=m('<div class="text-center py-8 text-black/50 dark:text-white/50"><p>当前页面没有目录</p></div>'),He=m('<span class="badge svelte-cz3h3s"> </span>'),Be=m('<span class="dot-square svelte-cz3h3s"></span>'),je=m('<span class="dot-small svelte-cz3h3s"></span>'),Je=m('<button><!> <span class="toc-text svelte-cz3h3s"> </span></button>'),Ne=m('<div class="toc-content svelte-cz3h3s"></div>'),Re=m(`<button aria-label="Table of Contents" id="mobile-toc-switch" class="btn-plain scale-animation rounded-lg h-11 w-11 active:scale-90 lg:!hidden theme-switch-btn"><!></button> <div id="mobile-toc-panel" class="float-panel float-panel-closed mobile-toc-panel absolute md:w-[20rem] w-[calc(100vw-2rem)]
		top-20 left-4 md:left-[unset] right-4 shadow-2xl rounded-2xl p-4 svelte-cz3h3s"><div class="flex items-center justify-between mb-4"><h3 class="text-lg font-bold text-[var(--primary)]"> </h3> <button aria-label="Close TOC" class="btn-plain rounded-lg h-8 w-8 active:scale-90 theme-switch-btn"><!></button></div> <!></div>`,1);function tt(re,le){Le(le,!1);let j=H([]),J=H([]),S=H(""),b,z=H(!1),P=!1,W=!1,X=3;const Z=async()=>{await ie.togglePanel("mobile-toc-panel")},$=async e=>{await ie.togglePanel("mobile-toc-panel",e)},ce=()=>{W=window.siteConfig?.toc?.useJapaneseBadge||!1,X=window.siteConfig?.toc?.depth||3;const e=document.querySelectorAll("h1, h2, h3, h4, h5, h6"),s=[],r=["ア","イ","ウ","エ","オ","カ","キ","ク","ケ","コ","サ","シ","ス","セ","ソ","タ","チ","ツ","テ","ト"];let a=0;e.forEach(l=>{if(l.id){const o=Number.parseInt(l.tagName.charAt(1),10);if(o>X)return;const n=(l.textContent||"").replace(/#+\s*$/,"");let p="";o===1&&(a++,W&&a-1<r.length?p=r[a-1]:p=a.toString()),s.push({id:l.id,text:n,level:o,badge:p})}}),E(j,s)},de=()=>{const e=document.querySelectorAll(".card-base"),s=[];e.forEach(r=>{const a=r.querySelector('a[href*="/posts/"].transition.group'),l=r.querySelector('a[href*="/categories/"].link-lg'),o=a?.querySelector('svg[data-icon="mdi:pin"]');if(a){const n=a.getAttribute("href"),p=a.textContent?.replace(/\s+/g," ").trim()||"",i=l?.textContent?.trim()||"",f=!!o;n&&p&&s.push({title:p,url:n,category:i,pinned:f})}}),E(J,s)},ve=()=>{const e=window.location.pathname;E(z,e==="/"||e===""||/^\/\d+\/?$/.test(e))},pe=e=>{const s=document.getElementById(e);if(s){$(!1);const a=s.offsetTop-80;window.scrollTo({top:a,behavior:"smooth"})}},fe=e=>{$(!1),ze(e)},N=()=>{const e=document.querySelectorAll("h1, h2, h3, h4, h5, h6"),s=window.scrollY,r=100;let a="";e.forEach(l=>{if(l.id){const o=l.offsetTop-r;s>=o&&(a=l.id)}}),E(S,a)},ue=()=>{const e=document.querySelectorAll("h1, h2, h3, h4, h5, h6");b&&b.disconnect(),b=new IntersectionObserver(s=>{s.forEach(r=>{r.isIntersecting&&E(S,r.target.id)})},{rootMargin:"-80px 0px -80% 0px",threshold:0}),e.forEach(s=>{s.id&&b.observe(s)})};let y=!1;const R=()=>{typeof window<"u"&&window.swup&&!y?(window.swup.hooks.on("page:view",()=>{setTimeout(()=>{T()},200)}),y=!0,console.log("MobileTOC Swup listener registered")):y||(window.addEventListener("popstate",()=>{setTimeout(T,200)}),y=!0,console.log("MobileTOC fallback listener registered"))},me=()=>{if(typeof window<"u")if(P=!!window.swup,P)R();else{const e=()=>{window.swup&&(P=!0,document.removeEventListener("swup:enable",e),R())};document.addEventListener("swup:enable",e),setTimeout(()=>{window.swup&&(P=!0,document.removeEventListener("swup:enable",e),R())},1e3)}},T=()=>{ve(),me(),t(z)?de():(ce(),ue(),N())};ke(()=>(setTimeout(T,100),window.addEventListener("scroll",N),()=>{b&&b.disconnect(),window.removeEventListener("scroll",N),typeof window<"u"&&window.swup&&window.swup.hooks.off("page:view"),window.removeEventListener("popstate",T),y=!1})),typeof window<"u"&&(window.mobileTOCInit=T),Ce();var ee=Re(),A=q(ee),we=u(A);B(we,{icon:"material-symbols:format-list-bulleted",class:"text-[1.25rem]"}),v(A);var te=x(A,2),D=u(te),K=u(D),he=u(K,!0);v(K);var V=x(K,2),be=u(V);B(be,{icon:"material-symbols:close",class:"text-[1rem]"}),v(V),v(D);var ge=x(D,2);{var _e=e=>{var s=U(),r=q(s);{var a=o=>{var n=Pe(),p=u(n);B(p,{icon:"material-symbols:article-outline",class:"text-2xl mb-2"}),Se(2),v(n),d(o,n)},l=o=>{var n=qe();se(n,5,()=>t(J),oe,(p,i)=>{var f=Oe(),g=u(f),k=u(g);{var Y=c=>{B(c,{icon:"mdi:pin",class:"pinned-icon"})};h(k,c=>{t(i).pinned&&c(Y)})}var F=x(k);v(g);var O=x(g,2);{var G=c=>{var w=Ae(),C=u(w,!0);v(w),I(()=>L(C,t(i).category)),d(c,w)};h(O,c=>{t(i).category&&c(G)})}v(f),I(()=>L(F,` ${t(i).title??""}`)),M("click",f,()=>fe(t(i).url)),d(p,f)}),v(n),d(o,n)};h(r,o=>{t(J).length===0?o(a):o(l,!1)})}d(e,s)},xe=e=>{var s=U(),r=q(s);{var a=o=>{var n=Me();d(o,n)},l=o=>{var n=Ne();se(n,5,()=>t(j),oe,(p,i)=>{var f=Je();let g;var k=u(f);{var Y=c=>{var w=He(),C=u(w,!0);v(w),I(()=>L(C,t(i).badge)),d(c,w)},F=c=>{var w=U(),C=q(w);{var ye=_=>{var Q=Be();d(_,Q)},Te=_=>{var Q=je();d(_,Q)};h(C,_=>{t(i).level===2?_(ye):_(Te,!1)},!0)}d(c,w)};h(k,c=>{t(i).level===1?c(Y):c(F,!1)})}var O=x(k,2),G=u(O,!0);v(O),v(f),I(()=>{g=Ie(f,1,`toc-item level-${t(i).level??""} ${t(S)===t(i).id?"active":""}`,"svelte-cz3h3s",g,{active:t(S)===t(i).id}),L(G,t(i).text)}),M("click",f,()=>pe(t(i).id)),d(p,f)}),v(n),d(o,n)};h(r,o=>{t(j).length===0?o(a):o(l,!1)})}d(e,s)};h(ge,e=>{t(z)?e(_e):e(xe,!1)})}v(te),I(e=>L(he,e),[()=>t(z)?ne(ae.postList):ne(ae.tableOfContents)]),M("click",A,Z),M("click",V,Z),d(re,ee),Ee()}export{tt as default};
